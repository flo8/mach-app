---
import Pagelayout from '@Pagelayout';
import Card from '@components/Card.astro';
import { getCourseDirectories, getCourseIndex, getCourseLessons } from '@api/courses';
import { CollectionStaticProps, Params } from '@models/courses';

export async function getStaticPaths() {
  const paramsList: CollectionStaticProps[] = [];

  try {
    //  const response = await fetch(import.meta.env.COURSES_ENDPOINT);
    // const response = await fetch('./courses.json');

    // const data = await response.json();
    const coursesDir = await getCourseDirectories('courses');

    Object.keys(coursesDir).forEach((key) => {
      paramsList.push({ params: { course: key }, props: { slugs: coursesDir[key] } });
    });
  } catch (error) {
    console.log('ERROR', error);
  }
  console.log('paramsList', paramsList);
  console.log('COURSES_ENDPOINT', import.meta.env.COURSES_ENDPOINT);

  return paramsList;
}
const { course } = Astro.params as Params;
// const entry = await getEntryBySlug('courses', `${course}/_index`);
// const entryResult = await entry?.render();
const Entry = await getCourseIndex('courses', course);
const courses = await getCourseLessons('courses', course);
---

<Pagelayout title='All vuejs courses'>
  {Entry && <Entry.Content />}
  {
    courses.map((course) => (
      <Card
        href={`/${course.collection}/${course.slug}`}
        title={course.data.title}
        body={course.data.description}
      />
    ))
  }
</Pagelayout>
