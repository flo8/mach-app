---
// const req = Astro.request;
// import ContentLayout from '@layouts/ContentLayout.astro';
// const data = await fetch(`${import.meta.env.BASE_URL}/api/login`, {
//   method: 'POST',
//   body: JSON.stringify({
//     access_token: hashParameters.get('access_token'),
//     expires_in: hashParameters.get('expires_in'),
//     refresh_token: hashParameters.get('refresh_token')
//   })
// });
// if (data.ok) {
//   return Astro.redirect(`${import.meta.env.BASE_URL}`);
// }
// Astro.cookies.set('counter', 'counter test');

// console.log('hash', Astro.request);
---

<script is:inline client:only>
  async function parseMagicLink() {
    const vals = window.location.hash
      .substring(1)
      .split('&')
      .map((kv) => kv.split('='));
    const hashParameters = new Map(vals);
    const access_token = hashParameters.get('access_token');
    const expires_in = hashParameters.get('expires_in');
    const refresh_token = hashParameters.get('refresh_token');
    let d = new Date();
    d = new Date(d.getTime() + expires_in * 1000);
    console.log('access_token', access_token);
    console.log('expires_in', d);
    console.log('refresh_token', refresh_token);
    localStorage.setItem('access_token', access_token);
    localStorage.setItem('expires_in', d);
    localStorage.setItem('refresh_token', refresh_token);
  }
  parseMagicLink();
</script>
